---
title: "Obligatorisk arbeidskrav"
output:
  html_document:
  #html_notebook:
    css: PAA.css
---

## Obligatorisk arbeidskrav
- Versjon 1.0
- Leveres ut (hele): 28.09.2022 (Canvas)
- Leveres inn: 26.10.2022 (Canvas og/eller postkassehylle min på Remmen)

<!--
- [Lenke til PDF-versjon](https://github.com/joernih/SFB30820Finansteori/blob/main/inst/arbeidskrav/arbeidskrav2021_v_1.1.pdf)
- [Lenke til PDF-versjon løsningsforslag](https://github.com/joernih/SFB30820Finansteori/blob/main/inst/arbeidskrav/arbeidskrav2021_v_1.1_losning.pdf)
- [Lenke til regneark](https://github.com/joernih/SFB30820Finansteori/blob/main/inst/arbeidskrav/cryptos_nyse.xlsx)

-->

[Lenke til publisert versjon her](https://github.com/joernih/SFB30820Finansteori/blob/main/inst/arbeidskrav/Finansteori%20(SFB30820)%2C%20H%C3%B8sten%202022.pdf)


```{r eval=T, echo=F}
#library(htmlTable)
```

```{r eval=FALSE, include=FALSE}
rmarkdown::render("arbeidskrav2021_F.Rmd")
system("brave arbeidskrav2021_F.html")
#servr::httw()
```

```{r, echo=F}
knitr::knit_exit()
```

# Del I: Generelle forståelse og tradisjonelle oppgaver
## Oppgave 1: Generell forståelse (forsøk å svar så kortfattet og presist som mulig)

(1) Forklare forskjellen mellom nåverdiutrykkene som benyttes for med og uten usikkerhet.

(2) Hva er forskjellen mellom forventet og realiserte verdi av en kontantstrøm?

(3) Ved vurdering av nye investeringprosjekter, forklar hvorfor det lett kan oppstå konflikt mellom forskjellige eiere i et selskap.

(4) Hva menes med prosjektets eller aksjens beta?

(5) Gi en forklaring om mekanismene som ligger til grunn for Tofondsresultatet.

(6) Forklar hvordan KVM er knyttet sammen med porteføljeteorien.

(7) Gitt at KVM skal virke i praksis, er det da nødvendig at alle investorene tror på modellens forutsetninger (begrunn svaret)?

(8) Hva menes med et finansielt instrument, og kan du gi noen eksemplar på bruken av dette? 

(9) Hvordan kan teknisk et selskap øke forholdet mellom gjeld og egenkapital (kapitalstrukturen)?

## Oppgave 2: Porteføljeteori to selskaper

For din portefølje har du mulighet til å investere et beløp på 10.000,- i selskap A og B. Avkastningen og sannsynligheten for de tre ulike tilstandene er gitt ved følgende tabell

```{r, echo=F}
df_eks_gen <- data.frame(tilstand=c(1,2,3),
                         prob=c(0.5,0.20,0.30),
                         avk_a=c(-0.10,0.50,0.20),
                         avk_b=c(0.20,-0.30,0.10)
                         )
# Et objekt
## Forventet avkasting, varians og standardavvik 
ex_a <- c(df_eks_gen$avk_a%*%df_eks_gen$prob) 
ex_b <- c(df_eks_gen$avk_b%*%df_eks_gen$prob)
vx_a <- c((df_eks_gen$avk_a-ex_a)^2%*%df_eks_gen$prob)
vx_b <- c((df_eks_gen$avk_b-ex_b)^2%*%df_eks_gen$prob)
sx_a <- vx_a^(1/2) 
sx_b <- vx_b^(1/2)
# Flere objekter
## Forventet avkasting, kovarians, standardavvik og korr 
w <- c(6000/10000,4000/10000)
port_returns <- (sum(w *c(ex_a,ex_b)))
cov_mat <- cov.wt(df_eks_gen[,c(3,4)], wt =df_eks_gen[,c(2)], cor = T, method='ML')$cov
port_risk_v <- t(w) %*% (cov_mat %*% w)
port_risk_s <- sqrt(t(w) %*% (cov_mat %*% w))
rownames(df_eks_gen) <- c(" ","   ","     ")
htmlTable::htmlTable(df_eks_gen, header=c("Tilstand ","Sannsynlighet ","Avkastning A ","Avkastning B"))
```

1. Finn forventet avkastning, variansen og standardavviket til hvert enkelt av de to selskapene.
1. Ta utgangspunkt i at 4.000,- av investeringsbeløpet investeres i selskap B, mens det resterende går til selskap A. Finn forventet avkastning, varians og standardavvik til porteføljen av de to selskapene.

## Oppgave 3: Porteføljeteorien

I utgangspunktet har vi følgende opplysninger fra markedet som vi har analysert

```{r, echo=F}
radnr <- c("Markedsporteføljen",
	   "Risikofri rente")
tils1 <- c(0.04,0.02)
tils2 <- c(0.02,0.00)

df_prosj_kontantstrøm <- data.frame(radnr,tils1,tils2)
rownames(df_prosj_kontantstrøm) <- c(" ","   ")
htmlTable::htmlTable(df_prosj_kontantstrøm, header=c("","Forventet avkastning","Standardavik"))
```

```{r, echo=F}
#library(reticulate)
#reticulate::repl_python()
#import json
#import sympy
#import numpy
### import matplotlib.pyplot as plt
#from sympy import solve, Eq, symbols, latex, simplify
#Er_p, Er_m, r_f, r_m, w, var1, var2, rho = sympy.symbols("Er_p, Er_m, r_f, r_m, w, var1, var2, rho")
#ERP = Eq(Er_p,w*r_f + (1-w)*r_m)
### Risk-lover investorene
#Er_pn = 0.44
#Er_mn = 0.04
#r_fn = 0.02
#w1 = sympy.solve(ERP,w)[0].subs([(r_f,r_fn),(r_m,Er_mn),(Er_p,Er_pn)])
#w2 = 1-w1
##Varpe.subs([(w_1,w1),(var1,0),(var2,0.03**2),(rho,0)])**(1/2)
##Varpe.subs([(w_1,w1),(var1,0),(var2,0.03**2),(rho,0)])**(1/2)**(1/2)
### Risikoavers investor
#Er_pn = 0.02
#Er_mn = 0.04
#r_fn = 0.02
#w1 = sympy.solve(ERP,w)[0].subs([(r_f,r_fn),(r_m,Er_mn),(Er_p,Er_pn)])
#w2 = 1-w1
##Varpe.subs([(w_1,w1),(var1,0),(var2,0.03**2),(rho,0)])**(1/2)
##Varpe.subs([(w_1,w1),(var1,0),(var2,0.03**2),(rho,0)])**(1/2)**(1/2)
#exit
```

Både Ole Spetalen og Lise Sparegris har i utgangspunktet et beløp på 2.000.000,- som de ønsker å investere.

1. Ole Spetalen er en risikosøkende investor som ønsker at forventet avkastning på sin portefølje skal være på 42 prosent. Gitt at vi legger til grunn porteføljeteorien, hvordan vil han fordele sin investeringer?
1. Lise Sparegris ønsker med god margin å sikre pensjonen sin. Ved bruk av samme porteføljeteori som Spetalen, hvordan vil hun fordele sine investeringer som forventet avkastning skal være på 2 prosent?
1. Både får Ole og Lise finn varians og tilhørende standardavvik for deres respektive portefølje.
1. Hvilken forutsetning om finansiering må være oppfylt for at Spetalen kan gjennomføre sin strategi, og er det helt sikkert at han vil oppnå en høyere avkastning enn det som Lise sikter imot?

## Oppgave 4: Kapitalverdimodellen og justert-nåverdi

Frøken Permanent er et lite AS som holder til på Halden Storsenter. Selskapet har som har som spesialitet microblading permanent makeup av bryn.
I forbindelse med et oppkjøp er det estimert at selskapets egenkapitalbeta $\beta_E=0.90$ og gjeldsbeta lik $\beta_G=0.20$. Den risikofrie renten i markedet på $2.5$ prosent, mens markedets risikopremie anslås til 5 prosent og Bryns skattesats er lik 15 prosent. Totalt sett har Bryn AS 200 aksjer utestående med beregnet markedspris lik 1.500,-. Utestående gjeld er på 200.000,-

```{r, echo=F, eval=F}
#1. Beregne vektene (markedsverdi) for egenkapital og gjeld
beta_E <- 0.90
beta_G <- 0.20
r_f <- 0.025
Er_m <- 0.05+0.025
ant_aksj <- 200
E <- 1500*200
G <- 200000
t <- 0.15
vec_var <- list(E=E,G=G,r_f=r_f,Er_m=Er_m,beta_E=beta_E,beta_G=beta_G,t=t)
w_E <- eval(parse(text='E/(E+G)'),vec_var)
w_G <- eval(parse(text='G/(E+G)'),list(E=E))
k_E <- eval(parse(text='r_f+beta_E*(Er_m-r_f)'),list(E=E))
k_G <- eval(parse(text='r_f+beta_G*(Er_m-r_f)'),list(E=E))
k_T <- eval(parse(text='w_E*k_E+(1-t)*w_G*k_G'),list(E=E))
100000/(k_T)
#(100000/(k_E))/ant_aksj
```

1. Basert på disse opplysningene, klarer du å finne totalkapitalkostnaden til selskapet?
1. Dersom selskapet framover anslås å ha en evigvarende driftsresultat (OFR) på 100.000,-, hva er verdien til selskapet i dag?

## Oppgave 5: Statsobligasjoner, terminrenter og rentens terminstruktur

### Obligasjoner

En obligasjon med 3 år til forfall har pålydende 5.000,-, kupongrente $r_k=0.07$ som utbetales n=1 ganger i året og årlige effektiv rente $r=0.06$. 
1. Beregn prisen for en ordinær obligasjon.


```{r include=FALSE}
y <- 3
n <- 1
T <- y*n
M <- 5000
r_k <- 0.07
r <- 0.06
# [1] 7440.939
one <- M*r_k/(1+r)^1
two <- M*r_k/(1+r)^2
thr <- M*r_k/(1+r)^3
P_o <- M/(1+0.06)^T
one+two+thr+P_o
# [1] 8396.193
```
En null-kupong-obligasjon med 4 år til forfall har pålydende 5.000,- med årlig effektiv rente $r=0.025$. 

1. Beregn prisen for null-kupong rente obligasjonen 

```{r, eval=T, echo=F} 
T <- 4
M_o <- 5000
r <- 0.025
M_o/(1+r)^T
```

### Rentens terminstruktur

Den kortsiktige spotrenten $_0r_1$ for ett år fram i tid er ved 1.5 prosent. Vider kan vi notere for null-kupongrente-obligasjoner for 2 og 3 år framover følgende opplysninger

```{r echo=FALSE}
Mv <- c(500,500,500)
P1 <-500/(1+0.015)
P2 <-500/(1+0.015)^2
P3 <-500/(1+0.015)^3
stats_df <- data.frame(lopetid=c(2,3),
		       M=Mv[2:3],
		       p=c(495,495)
		       )
one <- 1.015/1
two <- (M[1]/P2)^2
thr <- (M[2]/P3)^3
r_1_2 <- two/one-1
r_2_3 <- thr/two-1
rownames(stats_df) <- c(" ","  ") 
htmlTable::htmlTable(stats_df, header=c("Løpetid ","Pålydende ","Markedspris"))
```

Fra læreboka har vi at termin-/forwardrenten for periode $t$ er bestemt ved 

\begin{equation}
_{t-1}f_{t}=\frac{(1+_{0}r_{t})^{t}}{(1+_{0}r_{t-1})^{t-1}} - 1
\end{equation}

1. Hvilken sentral forutsetning ligger til grunn for at dette uttrykket holder ved likhet?
1. Beregn terminrenten (forwardrenten) for 2 og 3 år framover i tid.
1. Vis ved hjelp av en figur rentens terminstruktur (yield-kurven).
1. Kan du gi en kortfattet tolkning av hva denne kurven forteller oss?

# Del II: Porteføljeutregninger ved bruk av regnearket

Basert på vedlagte regnearket *cryptos_nyse.xlsx* som viser utviklingen for to ulike kryptovalutaer Bitcoin (BTC), Etherium (ETH) og utviklingen på New York børsen (NYSE), blir du bedt om å utføre følgende beregninger

## Enkeltinvesteringer

**Deskriptiv statistikk**

1. Lag en tidsserie som viser avkastningen for de to kryptovalutaene og New York børsen (NYSE). 
1. For hver enkelt tidsserie beregn:
	1. Gjennomsnittlig avkastning
	1. Varians
	1. Standardavvik
	1. Høyeste og laveste verdi

**Grafisk visning**

1. For hver enkelt tidsserie lag et scatterplot (x-aksen dager, y-aksen avkastning i prosent)

**Økonomisk tolkning**

Klarer du knytte noen økonomisk forklaringer tilhørende noen av mest ekstreme observasjoner du finner i tidsserien?

## Porteføljesammensetninger

**Deskriptiv statistikk**

1. Opprett et datasett som inneholder data kun over de tidsperiodene  hvor det er registrert observasjoner for *alle* de tre tidsseriene
1. Basert på dette datasettet beregn:
	1. Gjennomsnittlig avkastning
	2. Varians
	3. Standardavvik
	4. Korrelasjonskoeffisienten mellom de tre investeringsobjektene

**Grafisk visning**

1. Lag et scatterplot for hver ulike kombiversjonen av de tre investeringsobjektene (x-akse avkastning det ene objektet, y-aksen avkastning det andre objektet). Forsøk også få inn regresjonslinjen som oppsummerer graden av samvariasjon mellom de to objektene. 

**Porteføljeanalyse**

1. Basert på at brukeren selv kan justere porteføljevektene, lag en tabell i regnearket som viser utregningene av
```{r, echo=F}
radm <- c("BTC","ETH","NSE","BTC og ETH", "BTC og NSE", "BTC, ETH og NSE")
lr <- length(radm)
fi <- rep("Beregn",lr)
df_portf <- data.frame(var=fi, std=fi) 
htmlTable::htmlTable(df_portf, rnames=radm, rowlabel="Sammensetning av porteføljen",header=c("Porteføljens varians","Porteføljens standardavvik"))
```

1. Ved flere investeringsobjekter har du lært i dette kurset at porteføljerisikoen kan forklares av to komponenter: (1) usystematisk-risiko (2) for systematisk-risiko. Førstnevnte vil vanligvis reduseres når antall objekter som inngår i porteføljen øker.
	1. Hvordan stemmer dette resultat overens med de beregningene som du har utført her?
	1. Hvilke sentrale faktorer tror du kan være utslagsgivende for de resultatene du har kommet fram til?


```{r include=FALSE}
knitr::knit_exit()
```
# Test
```{r}
hiris <- as.matrix(head(iris))
colnames(hiris) <- c("","","","","")
rownames(hiris) <- c(" ","","","","","")
htmlTable::htmlTable(hiris)
```

