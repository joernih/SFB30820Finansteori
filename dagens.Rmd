---
title: "Finansteori (SFB30820)"
subtitle: "Forelesningsnotater"
author: "Jørn I.Halvorsen"
date: "2021/08/12 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    includes:
      in_header: "mathjax-equation-numbers.html"
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
#bibliography: pensum.bib
#output: 
#  html_notebook:
#  toc: false
---

```{r xaringan-tile-view, echo=FALSE, message=FALSE, warning=FALSE}
xaringanExtra::use_editable(expires = 1)
xaringanExtra::use_tile_view()
#xaringanExtra::use_share_again()
xaringanExtra::use_scribble()
xaringanExtra::use_webcam()
#xaringanExtra::use_slide_tone()
xaringanExtra::use_panelset()
library(htmlTable)
library(magrittr)
library(xaringan)
library(plotly)
```

```{r eval=FALSE, include=FALSE}
xaringan::inf_mr("dagens.Rmd")
servr::daemon_stop()
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
source("timeplan.R")
```
---

class: inverse, center, middle

# Forelesning 3: `r tema[3]`

**Læringsmål:**

-  Beskrive hvorfor risikoen i en portefølje reduseres når antall prosjekter i porteføljen øker.
-  Gi eksempler på kilder for systematisk og usystematisk risiko.
-  Beregne betaverdien til et prosjekt og forklare hva den fanger opp.

`r paste("Oppdatert:",Sys.Date())`

---

## Måling av risiko (portefølje fra 3 til n fonds)

**Metode 2 for måling av risiko (3 investeringsobjekter)**
Porteføljens varians er gitt ved
\begin{equation}
Var(r_p)=w_1^2Var(r_1)+w^2_2Var(r_2)+w^2_3Var(r_3) + \\
2w_aw_bStd(a)Std(b)Korr(a,b)+\\
2w_aw_cStd(a)Std(c)Korr(a,c)+\\
2w_bw_cStd(b)Std(c)Korr(b,c) 
\end{equation}
Mens standardavviket (som tidligere) framkommer som
\begin{equation}
Std(r_p)=\sqrt{Var(rp)}
\end{equation}

---

**Eksempel 2.6**

```{r, eval=T, echo=F}
w <- c(0.30, 0.40, 0.30)
df_eks_2_6 <- data.frame(aksje=c("A","B","C"),erp=c(0.12,0.15,0.25),std=c(0.10,0.20,0.40),korr=c(0.8,-0.1,0.5))
htmlTable(df_eks_2_6, header=c("Aksje","Forventet avkastning","Standardavvik","Korrelasjonskoeffisient"))
```

Hvor investert beløp vektene er gitt ved `r w`

Ved innsetting av formelen gir dette oss

\begin{equation}
Var(r_p)=(0.30)^2\cdot 0.10^2+(0.40)^2\cdot 0.20^2+(0.3)^2\cdot 0.40^2 \\ 
+2 \cdot 0.30 \cdot 0.40 \cdot 0.10 \cdot 0.20 \cdot 0.80 \\ 
-2 \cdot 0.30 \cdot 0.30 \cdot 0.10 \cdot 0.40 \cdot 0.10 \\ 
+2 \cdot 0.40 \cdot 0.30 \cdot 0.20 \cdot 0.40 \cdot 0.50 \\
= 0.02722
\end{equation}

\begin{equation*}
Std(r_p)=\sqrt{0.02722}=0.1649848
\end{equation*}

```{r, eval=T, echo=T}
#! doublecheck
(0.30)^2*0.10^2+(0.40)^2*0.20^2+(0.3)^2*0.40^2+2*0.30*0.40*0.10*0.20*0.80-2*0.30*0.30*0.10*0.40*0.10 +2*0.40*0.30*0.20*0.40*0.50
```

---

**Metode 2 for måling av risiko (generell metode med n investeringsobjekter)**

Porteføljens forventning er gitt ved
\begin{equation}
E(r_p)=\sum_{i=1}^{N}w_iE(r_i)=w_1E(r_1)+w_2E(r_2)+...+w_NE(r_N)
\end{equation}
Porteføljens varians gitt ved
\begin{equation}
Var(r_p)=\sum_{i=1}^{N}w_i^2Var(r_i)+\underset{i\neq j}{\sum_{i=1}^{N}\sum_{j=1}^{N}}w_iw_jKov(i,j)=\\
\sum_{i=1}^{N}w_i^2Var(r_i)+\underset{i\neq j}{\sum_{i=1}^{N}\sum_{j=1}^{N}}w_iw_jStd(i)Std(j)Korr(i,j)
\end{equation}
Mens standardavviket (som tidligere) er gitt ved
\begin{equation}
Std(r_p)=\sqrt{Var(rp)}
\end{equation}

---

- Merk: Det kan først være verdt å merke seg at første i variansuttrykket består av  $N$ leddd, mens siste av $N^2-N$ ledd

- Dersom vi antar at en like stort andel $1/N$ blir investert i hvert av de n objektene, kan vi skrive 
\begin{equation}
Var(r_p)=(1/N)^2(Var(r_1)+Var(r_2)+...+Var(r_N)))\\
+(1/N)^2(Cov(r_1,r_2)+Cov(r_1,r_2)+...+Cov(r_1,r_2))))
\end{equation}

Vi har at gjennomsnittlig varians ( $\overline{Var}$ ) er gitt ved

$$
\overline{Var}=\frac{1}{N}(Var(r_1)+Var(r_2)+...+Var(r_N))
$$

Mens gjennomsnittlig kovarians ( $\overline{Kov}$ ) er gitt ved

$$
\overline{Kov}=\frac{1}{N}(Cov(r_1,r_2)+Cov(r_1,r_2)+...+Cov(r_1,r_2))
$$

---

Uttrykket ovenfor kan derfor skrives som

\begin{equation}
Var(r_p)=N(1/N)^2(\overline{Var}) + (N^2-N)(\frac{1}{N})^2(\overline{Cov})
\end{equation}

Vi kan forenkle dette, slik at vi står igjen med

\begin{equation}
Var(r_p)=\frac{1}{N}(\overline{Var}) + (1-\frac{1}{N})(\overline{Cov})
\end{equation}

Uttrykket forteller oss

- Økt N gir
- $ N \rightarrow $
- Forholdet mellom

---

Eks. Oslo Børs 

Perioden 2011-2015 har vi at $\overline{Var}=0.021$
og gjennomsnittlig $\overline{Kov}=0.0229$

```{r, echo=FALSE, out.width="55%", fig.cap=""}
knitr::include_graphics("pensum/figurer-08.png")
```
---


.panelset[
.panel[.panel-name[R-kode (ikke pensum)]
```{r}
varo <- 0.21
kovo <- 0.0229
tportvar <- '(1/N)*varo + (1-1/N)*kovo'
N <- 1:60
df_n <- data.frame(N=N,varp=eval(parse(text=tportvar),c(varo=varo,kovo=kovo,list(N=N))))
```
]
.panel[.panel-name[Figur]
```{r, echo=F}
ggplot2::ggplot(df_n, aes(x=N,y=varp)) + geom_line()
```
]]

---

## Kilder til usystematisk og relevant risiko

Vi kan videre dekomponere (øvelse: se om du klarer å finne ut av det på egenhånd) uttrykket for porteføljevariansen for n finansobjekter.

\begin{equation}
Var(r_p)=(\frac{1}{N})\overline{Var}+(1-\frac{1}{N})\overline{Cov}=\\ 
\underset{\text{Systematisk risiko}}{\overline{Cov}} +
(\frac{1}{N}) \underset{\text{Usystematisk riskiko}}{(\overline{Var}-\overline{Cov})} 
\end{equation}

Det første leddet er her et mål på porteføljens *systematiske* (ikke diversifiserbare) risiko, mens det siste leddet representerer den *usystematiske* risikoen. 

**Øvelse:**...

---

## Betaverdien til et prosjekt

Forholdet mellom porteføljerisiko og risiko til en enkelt aksje

\begin{equation}
\beta_j=\frac{Cov(r_j,r_m)}{Var(r_m)}
\end{equation}

- $\beta_j>1$
- $\beta_j<1$
- $\beta_j=0$

Ved å utnytte sammenhengen om at $Kor()=\frac{Cov()}{Std()Std()}$, kan vi også skrive dette som

\begin{equation}
\beta_j=\frac{Kor(r_j,r_m)Std(r_j)}{Std(r_m)}
\end{equation}

---

```{r, echo=FALSE, out.width="55%", fig.cap=""}
knitr::include_graphics("pensum/figurer-09.png")
```

---

```{r, echo=FALSE, out.width="55%", fig.cap=""}
knitr::include_graphics("pensum/figurer-10.png")
```

