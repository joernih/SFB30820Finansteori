---
title: "Finansteori (SFB30820)"
subtitle: "Forelesningsnotater"
author: "Jørn I.Halvorsen"
date: "2021/08/12 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    includes:
      in_header: "mathjax-equation-numbers.html"
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
#bibliography: pensum.bib
#output: 
#  html_notebook:
#  toc: false
---

```{r xaringan-tile-view, echo=FALSE, message=FALSE, warning=FALSE}
xaringanExtra::use_editable(expires = 1)
xaringanExtra::use_tile_view()
#xaringanExtra::use_share_again()
xaringanExtra::use_scribble()
xaringanExtra::use_webcam()
#xaringanExtra::use_slide_tone()
xaringanExtra::use_panelset()
library(htmlTable)
library(magrittr)
library(xaringan)
library(FinancialMath)
```

```{r eval=FALSE, include=FALSE}
xaringan::inf_mr("dagens2.Rmd")
rmarkdown::render("dagens2.Rmd")
system("brave dagens.html")
#xaringan::inf_mr("presentations.Rmd")
servr::daemon_stop()
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
source("timeplan.R")
```

class: inverse, center, middle

# Forelesning 12: `r tema[12]`

- Redegjøre for max-funksjonene til kjøpsopsjoner og salgsopsjoner ved forfall.
- Konstruere kontantstrømsdiagram for kjøpsopsjoner og salgsopsjoner.
- Redegjøre for salg-kjøp-paritet og beregne verdien av ett element i pariteten ved hjelp av de øvrige elementene.
- Beregne verdien av en kjøpsopsjon med den binomiske opsjonsprismodellen.
- Beregne en kjøpsopsjons verdi ved hjelp av Black-Scholes-modellen.
- Redegjøre for hvordan opsjonsprismodeller kan brukes til å verdsette fleksibilitet.

`r paste("Oppdatert:",Sys.Date())`

---


# Binomisk opsjonsprismodell

Ved opsjonens forfallstidspunkt vil opsjonen ha en av to mulige verdier (binomisk)

**Eksempel 12.5:** Dagens kurs på oljeselskapet Petro er 620,-. Et usikkert oljeboringsprosjekt vil enten føre til at kursn stiger 775,- (dvs. 20 prosent økning som har 75 prosent sannsynlighet), eller falle til 527 (dvs. falle med 15 prosent som har 30 prosent sannsynlighet). Tre-måneders risikofri rente er git ved 0.01.

### Kontantstrømfordelingen av en akjse

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-74.png"))
```

---

### Kontantstrømfordelingen av en kjøpsopsjon

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-75.png"))
```
### Kontantstrømfordelingen av en sikringsportefølje

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-76.png"))
```
---

Gitt at sikringsporteføljen er risikofri, må de to mulige utfallene på tidspunkt 1 være identiske.


\begin{equation}
\theta A_0-mK_0=nA_0-mK_n
\end{equation}

Løser vi denne for $m$ får vi *sikringsforholdet* (det antall kjøpsopsjoner som må skrives/selges pr. aksje for at porteføljen av aksjer og opsjoner skal være risikofri:

$$
m = \frac{A(\theta-n)}{K_\theta-K_n}
$$
**Eksempel 12.5:** gir oss
$$
m = \frac{620(1.25-0.85)}{95}=2.61 \text{ kjøpsopsjoner per kjøpte aksje}
$$


---

Kravet om null arbitrasjegevinst betyr derfor at følgende sammenheng må gjelde mellom investeringen ( $t=0$ ) og kontantstrømmen ( $t=2$ ).

\begin{equation}
A_0 - mK_0 = \frac{nA_0-mK_n}{1+r_f}
\end{equation}

Løser vi dette for $K_o$ ved først å sette inn for $m$ får vi

\begin{equation}
K_0 = \frac{1}{1+r_f}[qK_\theta+(1-q)K_n]
\end{equation}
Hvor de to sikringssannsynlighetene $q$ og $(1-q)$ er definert som
\begin{equation*}
q=\frac{1+r_f-n}{\theta-n} \\
(1-q)=\frac{\theta-1-r_f}{\theta-n} 
\end{equation*}

Verdien til kjøpsopsjonen er derfor bestemt som den nedisikonterte verdien av 
*sikringssannsynligheten* (hakeparantesen omdanner en usikker kontantstrøm til dens sikkerhetskivalente kontantstrømmen, jmf. forelesning 1)


---

**Eksempel 12.5:** gir oss her

\begin{equation*}
q=\frac{1+0.01-0.85}{1.25-0.85}=0.4 \\
(1-q)=\frac{1.25-1-0.01}{1.25-0.85} =0.6
\end{equation*}

\begin{equation*}
K_0 = \frac{1}{1+0.01}[0.4\cdot 95+0.6\cdot 0] = 521.80
\end{equation*}

**Øvelse:** Kontrollregninger

---

- Opsjonsverdien er uavhenig av investors risikoholdning
- Opsjonsverdien er uavhenig av sannsynligheten for aksjekursendring
- Forventet aksjekurs er irrelevant for opsjonsverdien
- Kjøpsopsjonens verdi kan uttrykkes som den sikkerhetsekvivalente verdien verdien av kjøpsopsjonen ved forfall diskontert med risikofri rente
- Opsjonsverdien avhanger kun av de fem variablen: $A_o,\theta,n,r_f,I$ 

---

# Black-Scholes-modellen

Sentrale forutsetninger:
- Kontinuerlig tid
- Short-salg er mulig
- Det er ingen skatt eller transaksjonskostnader
- Aksjen betaler ikke dividende (footnote)
- Risikofri rent er konstant

\begin{equation}
K_0 = A_0N(d_1) -Ie^{-i_fT}N(d_2)
\end{equation}

hvor


\begin{equation}
d_1=\frac{ln(\frac{A_0}{I})+i_fT}{\sigma\sqrt{T}}+\frac{1}{2}\sigma\sqrt{T} \\
d_2=d_1 -\sigma\sqrt{T}
\end{equation}

mens sikgringsforholdet blir bestemt ved


\begin{equation}
m = \frac{1}{N(d_1)}
\end{equation}

---


**Eksempel 12.7** OBX-indeksen ble 31.08.2015 notert til 532.26-. Samme dag kontinuerlig risikofri årsrente beregnes til 1.2 prosent. Kjøpsopsjoner med Innløsningskurs
530,- og forfall 17.09.2015 ble omsatt til 15,25,-. OBX-indeksen årlige standardavvik er estimert til 30.4%.

Starter med 

\begin{equation}
d_1=\frac{ln(\frac{532.26}{530})+0.01217/365}{\sigma\sqrt{17/365}}+\frac{1}{2}\sigma\sqrt{17/365} =0.10618\\
d_2=d_1 -\sigma\sqrt{17/365}=0.04057
\end{equation}

Som ved bruk av standardnormalfordelingstabellen (interpolering) gir oss
\begin{equation}
N(d_1)=1-0.45772=0.542280\\
N(d_2)=1-0.483818=0.516182
\end{equation}

```{r, echo=F, eval=F}
1-0.542280
# [1] 0.45772
1-0.516182
# [1] 0.483818

```


Vi kan nå finne opsjonsprisen som er gitt ved

\begin{equation}
K_0 =532.26\cdot 0.542280 -530e^{-0.012(17/365)}0.516182=15.21
\end{equation}

---

# Sammenligning Binomisk modell og Black-Scholes modellen

\begin{equation}
K_0 = A_0N(d_1) -Ie^{-i_fT}N(d_2)
\end{equation}


\begin{equation}
K_0 = \frac{1}{1+r_f}[qK_\theta+(1-q)K_n]
\end{equation}


```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-77.png"))
```

---

# Opsjonstankegang i finansfaget


```{r, echo=F}
knitr::knit_exit()
```

$$
m=A_0(\theta-n)/(K_\theta-K_n)
$$

radnr <- c("Verdi av underliggende aksje",
	   "Innløsningskurs",
   "Tid til forfall (løpetid)",
   "Underliggende eiendels volatilitet",
   "Risikofri rente")
tils1 < c(" "," "," "," "," ")
tils2 < c(" "," "," "," "," ")
df_prosj_kont <- data.frame(radnr,tils1,tils2)
htmlTable(df_prosj_kont, header=c("Faktor","Kjøpsopsjon","Salgsopsjon"))


Salgsopsjonen kan indirekte verdsettes ved 










