---
title: "Finansteori (SFB30820)"
subtitle: "Forelesningsnotater"
author: "Jørn I.Halvorsen"
date: "2021/08/12 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    includes:
      in_header: "mathjax-equation-numbers.html"
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
#bibliography: pensum.bib
#output: 
#  html_notebook:
#  toc: false
---

```{r xaringan-tile-view, echo=FALSE, message=FALSE, warning=FALSE}
xaringanExtra::use_editable(expires = 1)
xaringanExtra::use_tile_view()
#xaringanExtra::use_share_again()
xaringanExtra::use_scribble()
xaringanExtra::use_webcam()
#xaringanExtra::use_slide_tone()
xaringanExtra::use_panelset()
library(htmlTable)
library(magrittr)
library(xaringan)
library(FinancialMath)
```

```{r eval=FALSE, include=FALSE}
xaringan::inf_mr("dagens.Rmd")
rmarkdown::render("dagens.Rmd")
system("brave dagens.html")
#xaringan::inf_mr("presentations.Rmd")
servr::daemon_stop()
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
source("timeplan.R")
```

class: inverse, center, middle

# Forelesning 12: `r tema[12]`

- Redegjøre for max-funksjonene til kjøpsopsjoner og salgsopsjoner ved forfall.
- Konstruere kontantstrømsdiagram for kjøpsopsjoner og salgsopsjoner.
- Redegjøre for salg-kjøp-paritet og beregne verdien av ett element i pariteten ved hjelp av de øvrige elementene.
- Beregne verdien av en kjøpsopsjon med den binomiske opsjonsprismodellen.
- Beregne en kjøpsopsjons verdi ved hjelp av Black-Scholes-modellen.
- Redegjøre for hvordan opsjonsprismodeller kan brukes til å verdsette fleksibilitet.

`r paste("Oppdatert:",Sys.Date())`

---

# Innledning

En *opsjon* er en kontrakt som gir opsjonseieren en rett, men ikke plikt, til å kjøpe eller selge en eiendel.

Opsjonsmodeller forsøker å prissette verdien av en opsjon. Det mange grunner til at dette er nyttig. Her er noen::
1. Benyttes i bedriftenes risikostyring.  
1. Øke din avkastning i kapitalmarkedet
1. Utbredt finansielt instrument
1. Besvare spørsmål som tidligere ikke hadde noen presise svar.

Hovedvekten i dette kapitlet er å forklare intuisjonen i slike opsjonsprisingmodeller, samt ha noe vekt på teori.

---

# Grunnetrekk ved opsjoner

En *opsjon* har egenskaper i form av at den gir *kjøperen:*

- Rett til å kjøpe eller selge en eiendel
- For en bestemt pris (*innløsningskursen*)
- På et forhåndsbestemt fremtidig tidspunkt (*forfallstidspunktet*)

---

## Opsjoner på ulike eiendeler

- **Akseopsjoner** (vi skal først se på verdsettingen av disse)
- Konvertible obligasjoner
- Valutakursopsjoner
- Kassakreditt har opsjonstrekk
- Private kontrakter 
- **En rekke investerings- og finansieringsbeslutninger har direkte og indirekte opsjonstrekk** (vi skal til slutt se på prinsippingen bak verdsettinge av disse)

---

## Standardisert opsjonskontrakt

Børsnotering og standardisering av opsjonskontrakter fordelaktig fordi det øker den underliggenes aksjen *likviditet*

Aksjeopsjoner på Oslø børs er standardisert ved at

- Består av: *Akseopsjoner (amerikanske) og indeksopsjoner (euroeiske)*
- Kontraktstørrelse: *En opsjon gir rett til 100 aksjer*
- Minimumskrav til handel: *10 kontrakter*

Merk: For å forenkle fremstillinge, studerer ser vi nå framover på kun europeiske opsjoner hvor det ikke er satt noe minumumskrav til handel.

---

## Opsjonens kontantstrøm ved forfall (t=T)

Kjøpsopsjon
\begin{equation}
K_T = \text{max}[0,(A_T-I)]
\end{equation}

Salgsopsjon
\begin{equation}
S_T = \text{max}[0,(I-A_T)]
\end{equation}

**Talleksempel 12.2**:

16 .  november kjøpe du både en kjøps- og salgsopsjon på Telenor-aksjen med innløsningskurs 170,-. Aksjekursen var da 149.50,-, mens opsjonskursen var hhhv. 0.35,- og 21,-. På forfallsdagoen var høyeste aksjekurs kr 151,50,-. Deg gir oss
\begin{equation*}
K_T = \text{max}[0,(151.50-170)] = 0
\end{equation*}

\begin{equation*}
S_T = \text{max}[0,(170-151.50)] = 18.50
\end{equation*}

---

**Kontantstrømdiagram for kjøps- og salgsopsjoner**

```{r, echo=FALSE, out.width="60%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-67.png"))
```

[Kraftinvestor Einar Aas](https://www.nettavisen.no/okonomi/agderposten-einar-aas-far-tilbake-200-millioner-kroner/s/12-95-3423885736)

---

## Opsjon, aksje og risikofritt prosjekt

Aksjer, obligasjoner, og kjøps- og salgsopsjoner kan kombineres parvis slik at den blir gitt denne samme kontantstrømmen

\begin{equation*}
A_T+S_T=B_T+K_T
\end{equation*}



```{r, echo=FALSE, out.width="80%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-68.png"))
```

*Kontantstrøm for aksje og salgsopsjon (par 1) og risikofri obligasjon og kjøpsobligasjon (par 2)*

---

Den parvise porteføljekombinasjonen løst for $B_T$ (risikofri kontantstrøm)

\begin{equation*}
B_T=A_T+S_T-K_T
\end{equation*}

```{r, echo=FALSE, out.width="80%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-69.png"))
```

*Kontantstrømmmen ved forfall for en portefølje med en aksje, salgsopsjon, og en solgt kjøpsopsjon*

---

## Salg-kjøp-paritet (SKP)

- Parvise porteføljekombinasjonen kan benyttes til å forklare såkalt salg-kjøp-paritet (SKP) ("put-cal-parity").
- En slik sammenheng er nyttig siden en har mulighet til å verdsette en salgsopsjon dersom en kjenner verdien til en tilsvarende kjøpsopsjon.
- Ved feilprising vil arbitrasjehandel sørge for at denne likevekten vil bli opprettholdt
- Sistnevnte gjør at vi kun trenger å kunne å konstruere modeller for kjøpsopsjoner.


Investeringsutlegget på $t=0$ er kjøp av en aksje, kjøp av salgsopsjon, og salg av en kjøpsopsjoner 
må tilsvare den neddiskonterte verdien av den risikofrie kontantstrømmen ved forfall

\begin{equation*}
A_0+S_0-K_0 = \frac{I}{1+r_f}
\end{equation*}

Omskrevet gir dette salg-kjøp-paritet (SKP)
\begin{equation*}
K_0-S_0=A_0-\frac{I}{1+r_f}
\end{equation*}

---

## Kontinuerlig forrentning

I opsjonssammenheng er det vanlig å operer med *kontinuerlig tid*. For eks. kan en tre-måneders periode deles inn i uendelige mange underperioder. Den kontinuerlige diskonteringsrenten vil da være gitt ved $e^{-i_f\cdot T}$
\begin{equation*}
K_0-S_0=A_0-Ie^{-i_f\cdot T}
\end{equation*}

---

# Bestemmelse av opsjonsverdi før forfall

```{r, echo=F}
radnr <- c("Verdi av underliggende aksje",
	   "Innløsningskurs",
   "Tid til forfall (løpetid)",
   "Underliggende eiendels volatilitet",
   "Risikofri rente")
tils1 <- c("?","?","?","?","?")
tils2 <- c("?","?","?","?","?")
df_prosj_kont <- data.frame(radnr,tils1,tils2)
htmlTable(df_prosj_kont, header=c("Faktor","Kjøpsopsjon","Salgsopsjon"))
```

**Øvelse:** Hva er dine a-priori oppfatninger om oppsjonsverdien ved en isolert økning i disse fem faktorene?

---

## Opsjonsverdi og aksjekurs (#1)

Tre betingelser

1. Nedre betingelse
1. Øvre betingelse
1. Verdibetingelse


```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-70.png"))
```

---

## Opsjonsverdi, innløsningskurs og kontraktstid (#2-3)

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-71.png"))
```
---

## Opsjonsverdi og aksjens volatilitet (# 4)

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-72.png"))
```


---

## Opsjonsverdi og rente (# 5)

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-72.png"))
```

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-73.png"))
```

---

## Opsjonens fem verdibestemmende faktorer 

```{r, echo=F}
radnr <- c("Verdi av underliggende aksje",
	   "Innløsningskurs",
   "Tid til forfall (løpetid)",
   "Underliggende eiendels volatilitet",
   "Risikofri rente")
tils1 <- c("+-","+-","+-","+-","+-")
tils2 <- c("+-","+-","+-","+-","+-")
df_prosj_kont2 <- data.frame(radnr,tils1,tils2)
htmlTable(df_prosj_kont2, header=c("Faktor","Kjøpsopsjon","Salgsopsjon"))
```

---

# Binomisk opsjonsprismodell

Ved opsjonens forfallstidspunkt vil opsjonen ha en av to mulige verdier (binomisk)

**Eksempel 12.5:** Dagens kurs på oljeselskapet Petro er 620,-. Et usikkert oljeboringsprosjekt vil enten føre til at kursn stiger 775,- (dvs. 20 prosent økning som har 75 prosent sannsynlighet), eller falle til 527 (dvs. falle med 15 prosent som har 30 prosent sannsynlighet). Tre-måneders risikofri rente er git ved 0.01.

### Kontantstrømfordelingen av en akjse

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-74.png"))
```

---

### Kontantstrømfordelingen av en kjøpsopsjon

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-75.png"))
```
### Kontantstrømfordelingen av en sikringsportefølje

```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-76.png"))
```
---

Gitt at sikringsporteføljen er risikofri, må de to mulige utfallene på tidspunkt 1 være identiske.


\begin{equation}
\theta A_0-mK_0=nA_0-mK_n
\end{equation}

Løser vi denne for $m$ får vi *sikringsforholdet* (det antall kjøpsopsjoner som må skrives/selges pr. aksje for at porteføljen av aksjer og opsjoner skal være risikofri:

$$
m = \frac{A(\theta-n)}{K_\theta-K_n}
$$
**Eksempel 12.5:** gir oss
$$
m = \frac{620(1.25-0.85)}{95}=2.61 \text{ kjøpsopsjoner per kjøpte aksje}
$$


---

Kravet om null arbitrasjegevinst betyr derfor at følgende sammenheng må gjelde mellom investeringen ( $t=0$ ) og kontantstrømmen ( $t=2$ ).

\begin{equation}
A_0 - mK_0 = \frac{nA_0-mK_n}{1+r_f}
\end{equation}

Løser vi dette for $K_o$ ved først å sette inn for $m$ får vi

\begin{equation}
K_0 = \frac{1}{1+r_f}[qK_\theta+(1-q)K_n]
\end{equation}
Hvor de to sikringssannsynlighetene $q$ og $(1-q)$ er definert som
\begin{equation*}
q=\frac{1+r_f-n}{\theta-n} \\
(1-q)=\frac{\theta-1-r_f}{\theta-n} 
\end{equation*}

Verdien til kjøpsopsjonen er derfor bestemt som den nedisikonterte verdien av 
*sikringssannsynligheten* (hakeparantesen omdanner en usikker kontantstrøm til dens sikkerhetskivalente kontantstrømmen, jmf. forelesning 1)


---

**Eksempel 12.5:** gir oss her

\begin{equation*}
q=\frac{1+0.01-0.85}{1.25-0.85}=0.4 \\
(1-q)=\frac{1.25-1-0.01}{1.25-0.85} =0.6
\end{equation*}

\begin{equation*}
K_0 = \frac{1}{1+0.01}[0.4\cdot 95+0.6\cdot 0] = 521.80
\end{equation*}

**Øvelse:** Kontrollregninger

---

- Opsjonsverdien er uavhenig av investors risikoholdning
- Opsjonsverdien er uavhenig av sannsynligheten for aksjekursendring
- Forventet aksjekurs er irrelevant for opsjonsverdien
- Kjøpsopsjonens verdi kan uttrykkes som den sikkerhetsekvivalente verdien verdien av kjøpsopsjonen ved forfall diskontert med risikofri rente
- Opsjonsverdien avhanger kun av de fem variablen: $A_o,\theta,n,r_f,I$ 

---

# Black-Scholes-modellen

Sentrale forutsetninger:
- Kontinuerlig tid
- Short-salg er mulig
- Det er ingen skatt eller transaksjonskostnader
- Aksjen betaler ikke dividende (footnote)
- Risikofri rent er konstant

\begin{equation}
K_0 = A_0N(d_1) -Ie^{-i_fT}N(d_2)
\end{equation}

hvor


\begin{equation}
d_1=\frac{ln(\frac{A_0}{I})+i_fT}{\sigma\sqrt{T}}+\frac{1}{2}\sigma\sqrt{T} \\
d_2=d_1 -\sigma\sqrt{T}
\end{equation}

mens sikgringsforholdet blir bestemt ved


\begin{equation}
m = \frac{1}{N(d_1)}
\end{equation}

---


**Eksempel 12.7** OBX-indeksen ble 31.08.2015 notert til 532.26-. Samme dag kontinuerlig risikofri årsrente beregnes til 1.2 prosent. Kjøpsopsjoner med Innløsningskurs
530,- og forfall 17.09.2015 ble omsatt til 15,25,-. OBX-indeksen årlige standardavvik er estimert til 30.4%.

Starter med 

\begin{equation}
d_1=\frac{ln(\frac{532.26}{530})+0.01217/365}{\sigma\sqrt{17/365}}+\frac{1}{2}\sigma\sqrt{17/365} =0.10618\\
d_2=d_1 -\sigma\sqrt{17/365}=0.04057
\end{equation}

Som ved bruk av standardnormalfordelingstabellen (interpolering) gir oss
\begin{equation}
N(d_1)=1-0.45772=0.542280\\
N(d_2)=1-0.483818=0.516182
\end{equation}

```{r, echo=F, eval=F}
1-0.542280
# [1] 0.45772
1-0.516182
# [1] 0.483818

```


Vi kan nå finne opsjonsprisen som er gitt ved

\begin{equation}
K_0 =532.26\cdot 0.542280 -530e^{-0.012(17/365)}0.516182=15.21
\end{equation}

---

# Sammenligning Binomisk modell og Black-Scholes modellen

\begin{equation}
K_0 = A_0N(d_1) -Ie^{-i_fT}N(d_2)
\end{equation}


\begin{equation}
K_0 = \frac{1}{1+r_f}[qK_\theta+(1-q)K_n]
\end{equation}


```{r, echo=FALSE, out.width="40%", fig.cap="", fig.align="center"}
knitr::include_graphics(c("pensum/figurer-77.png"))
```

---

# Opsjonstankegang i finansfaget


```{r, echo=F}
knitr::knit_exit()
```

$$
m=A_0(\theta-n)/(K_\theta-K_n)
$$

radnr <- c("Verdi av underliggende aksje",
	   "Innløsningskurs",
   "Tid til forfall (løpetid)",
   "Underliggende eiendels volatilitet",
   "Risikofri rente")
tils1 < c(" "," "," "," "," ")
tils2 < c(" "," "," "," "," ")
df_prosj_kont <- data.frame(radnr,tils1,tils2)
htmlTable(df_prosj_kont, header=c("Faktor","Kjøpsopsjon","Salgsopsjon"))


Salgsopsjonen kan indirekte verdsettes ved 










