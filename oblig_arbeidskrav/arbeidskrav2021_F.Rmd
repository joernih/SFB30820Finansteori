---
output:
  html_document:
  #html_notebook:
    css: PAA.css
#rnotb2 8900 $PWD arbeidskrav_losningsforslag.Rmd
---

```{r eval=T}
library(htmlTable)
```

```{r eval=FALSE, include=FALSE}
rmarkdown::render("arbeidskrav2021_F.Rmd")
servr::httw()
```

# Finansteori (SFB30820), Høsten 2021 
## Obligatorisk arbeidskrav 
- Versjon 1.1
- Leveres ut: 28.09.2021 (Canvas)
- Leveres inn: 26.10.2021 (Canvas)
  - Del I: kan lastes opp som dokument-fil eller pdf.
  - Del II: som regneark (merk: svarene på tekstspørsmålene kan her føres rett inn i regnearket)

# Del I: Generelle forståelse og tradisjonelle oppgaver
## Oppgave 1: Generell forståelse (forsøk å svar så kortfattet og presist som mulig)

(1) Forklare forskjellen mellom nåverdiutrykkene som benyttes for med og uten usikkerhet.

(2) Hva er forskjellen mellom forventet og realiserte verdi av en kontantstrøm?

(3) Ved vurdering av nye investeringprosjekter, forklar hvorfor det lett kan oppstå konflikt mellom forskjellige eiere i et selskap.

(4) Hva menes med prosjektets eller aksjens beta?

(5) Gi en forklaring om mekanismene som ligger til grunn for Tofondsresultatet.

(6) Forklar hvordan KVM er knyttet sammen med porteføljeteorien.

(7) Gitt at KVM skal virke i praksis, er det da nødvendig at alle investorene tror på modellens forutsetninger (begrunn svaret)?

(8) Hva menes med et finansielt instrument, og kan du gi noen eksemplar på bruken av dette? 

(9) Hvordan kan teknisk et selskap øke forholdet mellom gjeld og egenkapital (kapitalstrukturen)?

## Oppgave 2: Porteføljeteori to objekter 

```{r, echo=F}
Vi har en tabell
```




```{r, echo=F}
df_eks_gen <- data.frame(tilstand=c(1,2,3),
                         prob=c(0.2,0.5,0.3),
                         avk_a=c(0.16,0.12,0.06),
                         avk_b=c(0.05,0.20,0.40)
                         )
ex_a <- c(df_eks_gen$avk_a%*%df_eks_gen$prob)
ex_b <- c(df_eks_gen$avk_b%*%df_eks_gen$prob)
vx_a <- c((df_eks_gen$avk_a-ex_a)^2%*%df_eks_gen$prob)
vx_b <- c((df_eks_gen$avk_b-ex_b)^2%*%df_eks_gen$prob)
htmlTable::htmlTable(df_eks_gen, header=c("Tilstand","Sansynlighet","A","B"))
port_ret_a <- (sum(w*df_eks_gen$avk_a))
port_ret_b <- (sum(w*df_eks_gen$avk_b))
```

```{r}
# Varians	
port_risk_v <- t(w) %*% (cov_mat %*% w)
port_risk_s <- sqrt(t(w) %*% (cov_mat %*% w))
avkdf <- data.frame(pdraw=pd,w1=1-w[1], w2=w[2], w3=w[3],wc=sum(w)) %>%
avkdf

cov.wt(df_eks_gen[,c(3,4)])$cov

?cov.wt
xy <- data.frame(x = 1:10, y = c(1:3, 8:5, 8:10))
xy
w1 <- c(0,0,0,1,1,1,1,1,0,0)
cov.wt(xy, wt = w1) # i.e. method = "unbiased"
cov.wt(xy, wt = w1, method = "ML", cor = TRUE)
```

```{r, echo=F}
knitr::knit_exit()
```

Vi antar nå at investeringsbeløpet er likt fordelt mellom de to fondene, dvs $w_1=1/2,w_2=1-w_2=1/2$. 

Risikoen til det sammensatte fondet C kan måles ved bruk av både metode 1 og 2.

**Metode 1**
\begin{equation*}
Var(r_c) =0.2[0.105-0.17]^2+0.5[0.16-0.17]^2+0.3[0.23-0.17]^2=0.001975\\
Std(r_c)=\sqrt{0.001975}=0.044
\end{equation*}

**Metode 2**
\begin{equation*}
Var(r_c) =(1/2)^2(0.0013)+(1/2)^2(0.0156)-2(1/2)(1/2)0.045=0.001975 \\
Std(r_c)=\sqrt{0.001975}=0.044
\end{equation*}

Hvor vi har benyttet at
\begin{equation*}
Kov(r_a,r_b) = 0.2[0.16-0.11][0.05-0.23]+0.5[0.12-0.11][0.20-0.23]+\\
0.3[0.06-0.11][0.40-0.23]=-0.0045\\
\end{equation*}

## Oppgave 3: Porteføljeteori 

```{r, echo=F}
Vi har en tabell
```

Fra eksempel 3.1-3.2 har vi følgende opplysninger

```{r, echo=F}
radnr <- c("Markedsporteføljen",
	   "Portefølje I",
	   "Portefølje I",
	   "Risikofri rente")
tils1 <- c(0.07,0.05,0.08,0.04)
tils2 <- c(0.03,0.02,0.06,0.00)
df_prosj_kontantstrøm <- data.frame(radnr,tils1,tils2)
htmlTable(df_prosj_kontantstrøm, header=c("","Forventet avkastning","Standardavik"))
```

- Vi har at investor A (stor grad av risikoaversjon) ønsker å plassere 80 prosent av formuen risikofritt
  -  $E(r_p)=0.8\cdot 0.04 + 0.2\cdot 0.07=0.046$ 
  -  $Var(r_p)=0.8^2\cdot 0 + 0.2^2\cdot 0.03^2 +2\cdot 0.8\cdot 0.4\cdot 0=0.00004$
  -  $Std(r_p)=\sqrt{0.00004}  =0.006$
- Vi har at investor B (liten grad av risikoaversjon) ønsker at risikoen i porteføljen skal være på 8.5%
  -  $0.085=w\cdot 0.04 +(1-w)0.2\cdot 0.07 \Leftrightarrow w =-0.5$ og $1-w=1.5$ 
  -  $Var(r_p)=-0.5^2\cdot 0 + 1.5^2\cdot 0.03^2 \cdot 0.07 + 2 \cdot 0.5\cdot 1.5\cdot 0=0.02$
  -  $Std(r_p)=\sqrt{.02}  =0.045$

## Oppgave 4: KVM og justert nåverdi

```{r, echo=F}
Vi har en tabell
```

1. Beregne vektene (markedsverdi) for egenkapital og gjeld
\begin{equation*}
w_E=\frac{E}{E+G}=\frac{12654}{12654+3212}=0.80 \\ 
w_G=\frac{G}{E+G}=\frac{3212}{12654+3212}=0.20
\end{equation*}
1. Kapitalkostnad for egenkapital
$$
k_E=r_f+\beta_E[E(r_m) - rf]=0.03+0.83[0.08 - 0.03] = 0.0715
$$
1. Kapitalkostnad for gjeld
$$
k_G=r_f+\beta_G[E(r_m) - rf] = 0.03+0.1[0.05]= 0.035 
$$
1. Totalkapitalkostnad for selskapet
$$
k_T= k_Ew_E + k_G(1-s)w_G = 0.0715\cdot0.8 + 0.035\cdot(1-0.05)0.2 = 0.063
$$

## Oppgave 5: statsobligasjoner og rentens terminstruktur

```{r, echo=F}
Vi har en tabell
```
**Eksempel 5.2:** Vi har tre statsobligasjoner med pålydende 1000 og årlig kupongrente på 60 kroner. Videre har vi
```{r, echo=F}
stats_df <- data.frame(lopetid=c(1,2,3),
		       M=c(1000,1000,1000),
		       p=c(1019.23,1018.59,1013.49),
		       rente=c(4,5,5.5)
		       )
##htmlTable(df1,header=c("Sannsynlighet","Prosjekt X","Prosjekt Y","Prosjekt Z"))
#htmlTable(dfn12,header=c("Sannsynlighet","Tilstandsbeskrivelse","Prosjekt X","Prosjekt Y","Prosjekt Z"))
#til obligasjonene er gitt ved $P_{0,1}=1019.23$, $P_{0,1}=1018.59$, og P_{0,1}=1013.49$.
htmlTable(stats_df, header=c("Løpetid","Pålydende","Markedspris","Effektiv rente"))
```

*Terminrente periode 2*

\begin{equation*}
_{1}f_{2}=\frac{(1+_{0}r_{2})^{2}}{(1+_{0}r_{1})^{1}} - 1 = 
\frac{(1+0.05)^2}{(1+0.04)^1}-1=0.0601
\end{equation*}

*Terminrente periode 3*

\begin{equation*}
_{2}f_{3}=\frac{(1+_{0}r_{3})^{3}}{(1+_{0}r_{2})^{2}} - 1
=\frac{(1+0.055)^3}{(1+0.05)^2}-1=0.0651
\end{equation*}

---

- **Beregning av inflasjonsforventningene**

Vi starter med definisjonen mellom realrenten, nominal rente og inflasjon som er gitt ved
\begin{equation}
1+r=\frac{1+i}{1+j} \Leftrightarrow
1+j+r+rj=i+1 \\
r(1+j)=i-j \\
r=\frac{i-j}{1+j}
\end{equation}

Uttrykt ved symbolene for terminrenter gjør at vi kan skrive

\begin{equation}
_{t-1}f^R_t=\frac{_{t-1}f^N_t-_{t-1}j_{t}}{1+_{t-i}j_t}
\end{equation}

---

**Eksempel 5.3:**

*Forventet realrente periode 2*
\begin{equation*}
_{1}f^R_2=\frac{_{1}f^N_2-_{1}j_{2}}{1+_{1}j_2}
=\frac{0.0601-0.0317}{1+0.0317}=0.0275
\end{equation*}

*Forventet realrente periode 3*
\begin{equation*}
_{2}f^R_3=\frac{_{2}f^N_3-_{2}j_{2}}{1+_{2}j_3}
=\frac{0.0651-0.0317}{1+0.0317}=0.0324
\end{equation*}
# Del II: Porteføljeutregninger ved bruk av regnearket

Basert på vedlagte regnearket *cryptos_nyse.xlsx* som viser utviklingen for to ulike kryptovalutaer Bitcoin (BTC), Etherium (ETH) og utviklingen på New York børsen (NYSE), blir du bedt om å utføre følgende beregninger

## Enkeltinvesteringer

**Deskriptiv statistikk**

1. Lag en tidsserie som viser avkastningen for de to kryptovalutaene og New York børsen (NYSE). 
1. For hver enkelt tidsserie beregn:
	1. Gjennomsnittlig avkastning
	1. Varians
	1. Standardavvik
	1. Høyeste og laveste verdi

**Grafisk visning**

1. For hver enkelt tidsserie lag et scatterplot (x-aksen dager, y-aksen avkastning i prosent)

**Økonomisk tolkning**

Klarer du knytte noen økonomisk forklaringer tilhørende noen av mest ekstreme observasjoner du finner i tidsserien?

## Porteføljesammensetninger

**Deskriptiv statistikk**

1. Opprett et datasett som inneholder data kun over de tidsperiodene  hvor det er registrert observasjoner for *alle* de tre tidsseriene
1. Basert på dette datasettet beregn:
	1. Gjennomsnittlig avkastning
	2. Varians
	3. Standardavvik
	4. Korrelasjonskoeffisienten mellom de tre investeringsobjektene

**Grafisk visning**

1. Lag et scatterplot for hver ulike kombiversjonen av de tre investeringsobjektene (x-akse avkastning det ene objektet, y-aksen avkastning det andre objektet). Forsøk også få inn regresjonslinjen som oppsummerer graden av samvariasjon mellom de to objektene. 

**Porteføljeanalyse**

1. Basert på at brukeren selv kan justere porteføljevektene, lag en tabell i regnearket som viser utregningene av
```{r, echo=F}
radm <- c("BTC","ETH","NSE","BTC og ETH", "BTC og NSE", "BTC, ETH og NSE")
lr <- length(radm)
fi <- rep("Beregn",lr)
df_portf <- data.frame(var=fi, std=fi) 
htmlTable::htmlTable(df_portf, rnames=radm, rowlabel="Sammensetning av porteføljen",header=c("Porteføljens varians","Porteføljens standardavvik"))
```

1. Ved flere investeringsobjekter har du lært i dette kurset at porteføljerisikoen kan forklares av to komponenter: (1) usystematisk-risiko (2) for systematisk-risiko. Førstnevnte vil vanligvis reduseres når antall objekter som inngår i porteføljen øker.
	1. Hvordan stemmer dette resultat overens med de beregningene som du har utført her?
	1. Hvilke sentrale faktorer tror du kan være utslagsgivende for de resultatene du har kommet fram til?

```{r, echo=F}
knitr::knit_exit()
```
