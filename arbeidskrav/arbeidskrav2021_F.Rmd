---
output:
  #html_document:
  html_notebook:
    css: PAA.css
---

```{r eval=T, echo=F}
library(htmlTable)
```

```{r eval=FALSE, include=FALSE}
rmarkdown::render("arbeidskrav2021_F.Rmd")
system("brave arbeidskrav2021_F.html")
#servr::httw()
```

# Finansteori (SFB30820), Høsten 2021 
## Obligatorisk arbeidskrav 
- Versjon 1.1
- Leveres ut: 28.09.2021 (Canvas)
- Leveres inn: 26.10.2021 (Canvas)
  - Del I: kan lastes opp som dokument-fil eller pdf.
  - Del II: som regneark (merk: svarene på tekstspørsmålene kan her føres rett inn i regnearket)

# Del I: Generelle forståelse og tradisjonelle oppgaver
## Oppgave 1: Generell forståelse (forsøk å svar så kortfattet og presist som mulig)

(1) Forklare forskjellen mellom nåverdiutrykkene som benyttes for med og uten usikkerhet.

(2) Hva er forskjellen mellom forventet og realiserte verdi av en kontantstrøm?

(3) Ved vurdering av nye investeringprosjekter, forklar hvorfor det lett kan oppstå konflikt mellom forskjellige eiere i et selskap.

(4) Hva menes med prosjektets eller aksjens beta?

(5) Gi en forklaring om mekanismene som ligger til grunn for Tofondsresultatet.

(6) Forklar hvordan KVM er knyttet sammen med porteføljeteorien.

(7) Gitt at KVM skal virke i praksis, er det da nødvendig at alle investorene tror på modellens forutsetninger (begrunn svaret)?

(8) Hva menes med et finansielt instrument, og kan du gi noen eksemplar på bruken av dette? 

(9) Hvordan kan teknisk et selskap øke forholdet mellom gjeld og egenkapital (kapitalstrukturen)?

## Oppgave 2: Porteføljeteori to selskaper

For din portefølje har du mulighet til å investere et beløp på 10.000,- i selskap A og B. Avkastningen og sannsynligheten for de tre ulike tilstandene er gitt ved følgende tabell

```{r, echo=F}
df_eks_gen <- data.frame(tilstand=c(1,2,3),
                         prob=c(0.5,0.20,0.30),
                         avk_a=c(-0.10,0.50,0.20),
                         avk_b=c(0.20,-0.30,0.10)
                         )
# Et objekt
## Forventet avkasting, varians og standardavvik 
ex_a <- c(df_eks_gen$avk_a%*%df_eks_gen$prob) 
ex_b <- c(df_eks_gen$avk_b%*%df_eks_gen$prob)
vx_a <- c((df_eks_gen$avk_a-ex_a)^2%*%df_eks_gen$prob)
vx_b <- c((df_eks_gen$avk_b-ex_b)^2%*%df_eks_gen$prob)
sx_a <- vx_a^(1/2) 
sx_b <- vx_b^(1/2)
# Flere objekter
## Forventet avkasting, kovarians, standardavvik og korr 
w <- c(6000/10000,4000/10000)
port_returns <- (sum(w *c(ex_a,ex_b)))
cov_mat <- cov.wt(df_eks_gen[,c(3,4)], wt =df_eks_gen[,c(2)], cor = T, method='ML')$cov
port_risk_v <- t(w) %*% (cov_mat %*% w)
port_risk_s <- sqrt(t(w) %*% (cov_mat %*% w))
htmlTable::htmlTable(df_eks_gen, header=c("Tilstand","Sannsynlighet","Avkastning A","Avkastning B"))
```

1. Finn forventet avkastning, variansen og standardavviket til hvert enkelt av de to selskapene.
1. Ta utgangspunkt i at 4000,- av investeringsbeløpet investeres i selskap B, mens det resterende går til selskap B. Finn forventet avkastning, varians og standardavvik til porteføljen av de to selskapene.

## Oppgave 3: Porteføljeteorien

I utgangspunktet har vi følgende opplysninger fra markedet som vi har analysert

```{r, echo=F}
radnr <- c("Markedsporteføljen",
	   "Risikofri rente")
tils1 <- c(0.06,0.04)
tils2 <- c(0.02,0.00)
df_prosj_kontantstrøm <- data.frame(radnr,tils1,tils2)
htmlTable(df_prosj_kontantstrøm, header=c("","Forventet avkastning","Standardavik"))
```

```{r, echo=F}
library(reticulate)
reticulate::repl_python()
import json
import sympy
import numpy
# import matplotlib.pyplot as plt
from sympy import solve, Eq, symbols, latex, simplify
Er_p, w_1, w_2, r_f, r_m, var1, var2, rho = sympy.symbols('Er_p, w_1, w_2, r_f, r_m, var1, var2, rho')
ERP = Eq(Er_p,w_1*r_f + (1-w_1)*r_m)
## Risk-lover investorene
Er_pn = 0.42
r_mn = 0.02
r_fm = 0.06
w1 = sympy.solve(ERP,w_1)[0].subs([(r_f,r_fn),(r_m,r_mn),(Er_p,Er_pn)])
w2 = 1-w1
Varpe.subs([(w_1,w1),(var1,0),(var2,0.03**2),(rho,0)])**(1/2)
Varpe.subs([(w_1,w1),(var1,0),(var2,0.03**2),(rho,0)])**(1/2)**(1/2)
## Risikoavers investor
Er_pn = 0.02
r_mn = 0.02
r_fm = 0.06
w1 = sympy.solve(ERP,w_1)[0].subs([(r_f,r_fn),(r_m,r_mn),(Er_p,Er_pn)])
w2 = 1-w1
Varpe.subs([(w_1,w1),(var1,0),(var2,0.03**2),(rho,0)])**(1/2)
Varpe.subs([(w_1,w1),(var1,0),(var2,0.03**2),(rho,0)])**(1/2)**(1/2)
```

1. Ole Spetalen er en risikosøkende investor som ønsker at forventet avkastning på sin portefølje skal være på 42 prosent. Gitt at vi legger til grunn porteføljeterien, hvordan vil han fordele sin investeringer?
1. Lise Sparegris ønsker med god margin å sikre pensjonen sin. Ved bruk av samme modell som Spetalen, hvordan vil hun fordele sine investeringer som forventet avkastning skal være på 2 prosent?
1. Både får Ole og lise finn varians og tilhørende standardavvik for deres respektive portefølje.
1. Hvilken forutsetning om finansiering må være oppfylt for at Spetalen kan gjenomføre sin strategi? Og er det helt sikkert at han vil oppnå sitt mål dersom denne forutsetningen er oppfylt?   

## Oppgave 4: Kapitalverdimodellen og justert-nåverdi

```{r, echo=F}
#1. Beregne vektene (markedsverdi) for egenkapital og gjeld
beta_E <- 0.83
beta_G <- 0.16
r_f <- 0.03
Er_m <- 0.08
E <- 12654
G <- 3212
vec_var <- list(E=E,G=G,r_f=r_f,Er_m=Er_m,beta_E=beta_E,beta_G=beta_G)
w_E <- eval(parse(text='E/(E+G)'),vec_var)
w_G <- eval(parse(text='G/(E+G)'),list(E=E))
k_E <- eval(parse(text='r_f+beta_E*(Er_m-r_f)'),list(E=E))
k_G <- eval(parse(text='r_f+beta_G*(Er_m-r_f)'),list(E=E))
k_T <- eval(parse(text='w_E*k_E+w_G*k_G'),list(E=E))
```

Frøken Brynabc er et selskap som har som  spesialitet microblading  permanent makeup av bryn. 
- $\beta_E=0.83$
- $\beta_G=0.1$
- Den nominelle risikofrie renten er på $3$ prosent
- Mens markedets risikopremie anslås til 5 prosent og Tomras skattesats er lik 5 prosent. 
- Frøken Bryn har en skattesats er lik 5 prosent.
- Totalt sett har Bryn  200 aksjer utestående (pålydende 1,- per aksje) med markedspris lik 85,50 den 02.02.2016. Det gir en markedsverdi på egenkapital lik $=148020078\cdot 85.50=$ 12 654 mill. Fra årsrapporten har vi videre

```{r, echo=F}
radnr_i <- c("Innskutt egenkapital",
	   "Opptjent egenkapital",
	   "Gjeld",
	   "Totalt")
w1 <- c(1066,2879,3212,7317)
df_aarsrapport <- data.frame(radnr_i,w1)
htmlTable(df_aarsrapport, header=c("",""))
```

1. Basert på disse opplysningene, finn totalkapitalkostnaden til selskapet
1. Nåverdi 
1. Dagens markedsverdi på aksjen

## Oppgave 5: Statsobligasjoner, terminrenter og rentens terminstruktur

### Obligasjoner

En obligasjon med n=5 år til forfall har pålydende 10 000,-, kupongrente $r_k=0.05$ som utbetales n=2 ganger i året og årlige effektiv rente $r=0.06$. 
1. Beregn prisen for en ordinær obligasjon
```{r, eval=F, echo=F} 
(0.05*10000)*
((1-(1/(0.03))^(10+1))/
(1-(1/(0.03))))
# [1] 7440.939
10000/(1-(1/0.03))^10
# [1] 8.007468e-12
```

1. Beregn prisen for null-kupong rente obligasjonen 
```{r, eval=F, echo=F} 
(0.05*10000)*
((1-(1/(0.03))^(10+1))/
(1-(1/(0.03))))
# [1] 7440.939
10000/(1-(1/0.03))^10
# [1] 8.007468e-12
```

### Renten terminstruktur

Vi har tre statsobligasjoner med pålydende 1000 og årlig kupongrente på 60 kroner. Videre har vi
```{r, echo=F}
stats_df <- data.frame(lopetid=c(1,2,3),
		       M=c(1000,1000,1000),
		       p=c(1019.23,1018.59,1013.49),
		       rente=c(4,5,5.5)
		       )
##htmlTable(df1,header=c("Sannsynlighet","Prosjekt X","Prosjekt Y","Prosjekt Z"))
#htmlTable(dfn12,header=c("Sannsynlighet","Tilstandsbeskrivelse","Prosjekt X","Prosjekt Y","Prosjekt Z"))
#til obligasjonene er gitt ved $P_{0,1}=1019.23$, $P_{0,1}=1018.59$, og P_{0,1}=1013.49$.
htmlTable(stats_df, header=c("Løpetid","Pålydende","Markedspris","Effektiv rente"))
```

Fra læreboka har vi at termin-/forwardrenten for periode $t$ er bestemt ved 

\begin{equation}
_{t-1}f_{t}=\frac{(1+_{0}r_{t})^{t}}{(1+_{0}r_{t-1})^{t-1}} - 1
\end{equation}

1. Hvilken sentral forusetning ligger til grunn for at dette uttrykket holder ved likhet?
1. Beregn terminpremien for 2,3
1. Vis ved hjelp av en figur rentens terminstruktur (yield-kurven)
1. Kan du gi en kortfattet tolkning av hva denne kurven forteller oss?

# Del II: Porteføljeutregninger ved bruk av regnearket

Basert på vedlagte regnearket *cryptos_nyse.xlsx* som viser utviklingen for to ulike kryptovalutaer Bitcoin (BTC), Etherium (ETH) og utviklingen på New York børsen (NYSE), blir du bedt om å utføre følgende beregninger

## Enkeltinvesteringer

**Deskriptiv statistikk**

1. Lag en tidsserie som viser avkastningen for de to kryptovalutaene og New York børsen (NYSE). 
1. For hver enkelt tidsserie beregn:
	1. Gjennomsnittlig avkastning
	1. Varians
	1. Standardavvik
	1. Høyeste og laveste verdi

**Grafisk visning**

1. For hver enkelt tidsserie lag et scatterplot (x-aksen dager, y-aksen avkastning i prosent)

**Økonomisk tolkning**

Klarer du knytte noen økonomisk forklaringer tilhørende noen av mest ekstreme observasjoner du finner i tidsserien?

## Porteføljesammensetninger

**Deskriptiv statistikk**

1. Opprett et datasett som inneholder data kun over de tidsperiodene  hvor det er registrert observasjoner for *alle* de tre tidsseriene
1. Basert på dette datasettet beregn:
	1. Gjennomsnittlig avkastning
	2. Varians
	3. Standardavvik
	4. Korrelasjonskoeffisienten mellom de tre investeringsobjektene

**Grafisk visning**

1. Lag et scatterplot for hver ulike kombiversjonen av de tre investeringsobjektene (x-akse avkastning det ene objektet, y-aksen avkastning det andre objektet). Forsøk også få inn regresjonslinjen som oppsummerer graden av samvariasjon mellom de to objektene. 

**Porteføljeanalyse**

1. Basert på at brukeren selv kan justere porteføljevektene, lag en tabell i regnearket som viser utregningene av
```{r, echo=F}
radm <- c("BTC","ETH","NSE","BTC og ETH", "BTC og NSE", "BTC, ETH og NSE")
lr <- length(radm)
fi <- rep("Beregn",lr)
df_portf <- data.frame(var=fi, std=fi) 
htmlTable::htmlTable(df_portf, rnames=radm, rowlabel="Sammensetning av porteføljen",header=c("Porteføljens varians","Porteføljens standardavvik"))
```

1. Ved flere investeringsobjekter har du lært i dette kurset at porteføljerisikoen kan forklares av to komponenter: (1) usystematisk-risiko (2) for systematisk-risiko. Førstnevnte vil vanligvis reduseres når antall objekter som inngår i porteføljen øker.
	1. Hvordan stemmer dette resultat overens med de beregningene som du har utført her?
	1. Hvilke sentrale faktorer tror du kan være utslagsgivende for de resultatene du har kommet fram til?


```{r eval=F, include=FALSE}
knitr_knit_exit()
```

- Oppdater forelesningsnotater 0
- Kill row-indeks
- Oppdatert notater

